-- Changed name references to "Flyzxastra"

-- Main GUI creation
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Flyzxastra_GUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
-- ==============================================
-- made by pa1n edited by teor Aura Script
-- Version: 1 - 2X FASTER EDITION + ANTI-RAGDOLL
-- Features:
-- 1. 2X FASTER APS Control: 1-3000 attacks per second (was 1500)
-- 2. Range Control: 1-250 studs
-- 3. Professional Modern GUI
-- 4. Target Specific Player by Name (NOW WITH COMMA-SEPARATED NAMES)
-- 5. Toggle Script On/Off with E key (ADDED)
-- 6. Enhanced Error Handling & Performance
-- 7. AVOID PLAYERS FEATURE (NEW!)
-- 8. ANTI-RAGDOLL SYSTEM (NEW!)
-- 9. GRAB/FALL FIXES (NEW!)
-- 10. ANTI-FLING SYSTEM (NEW!)
-- ==============================================

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TextService = game:GetService("TextService")

-- Player reference
local player = Players.LocalPlayer

-- Script State
local ScriptEnabled = false
local originalSizes = {}
local auraConnection = nil
local antiRagdollConnection = nil
local antiFlingConnection = nil
local lastAttackTime = 0
local targetPlayerNames = ""
local avoidPlayerNames = ""
local targetList = {}
local avoidList = {}
local isCharacterSafe = true

-- Configuration - 2X FASTER!
local attacksPerSecond = 400  -- Changed from 200 to 400 (2x faster!)
local attackCooldown = 1 / attacksPerSecond
local attackRange = 50

-- Remote paths
local HitRemote = game:GetService("ReplicatedStorage")
    :WaitForChild("Packages")
    :WaitForChild("Knit")
    :WaitForChild("Services")
    :WaitForChild("CombatService")
    :WaitForChild("RF")
    :WaitForChild("Hit")

-- ==================== HELPER FUNCTIONS ====================
local function updateTargetList()
    targetList = {}
    if targetPlayerNames == "" then return end
    
    -- Split by comma and trim whitespace
    for name in targetPlayerNames:gmatch("[^,]+") do
        local trimmedName = name:gsub("^%s*(.-)%s*$", "%1")
        if trimmedName ~= "" then
            targetList[trimmedName:lower()] = true
        end
    end
    
    print("Target list updated: " .. targetPlayerNames)
    print("Target List Contents:")
    for name in pairs(targetList) do
        print("  - " .. name)
    end
end

local function updateAvoidList()
    avoidList = {}
    if avoidPlayerNames == "" then return end
    
    -- Split by comma and trim whitespace
    for name in avoidPlayerNames:gmatch("[^,]+") do
        local trimmedName = name:gsub("^%s*(.-)%s*$", "%1")
        if trimmedName ~= "" then
            avoidList[trimmedName:lower()] = true
        end
    end
    
    print("Avoid list updated: " .. avoidPlayerNames)
end

-- ==================== ANTI-FLING SYSTEM ====================
local function setupAntiFling()
    if antiFlingConnection then
        antiFlingConnection:Disconnect()
    end
    
    antiFlingConnection = RunService.Heartbeat:Connect(function()
        if not player.Character then return end
        
        local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        -- Detect high velocity (indicates fling)
        local velocity = humanoidRootPart.Velocity
        local speed = velocity.Magnitude
        
        if speed > 100 then
            -- Gradually reduce velocity
            local reductionFactor = 0.8
            humanoidRootPart.Velocity = velocity * reductionFactor
            -- Apply anti-fling force
            local antiForce = -velocity.Unit * math.min(speed * 0.5, 200)
            humanoidRootPart.Velocity = humanoidRootPart.Velocity + antiForce
        end
        
        -- Prevent extreme spinning
        local angularVelocity = humanoidRootPart.AssemblyAngularVelocity
        if angularVelocity.Magnitude > 20 then
            humanoidRootPart.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
        end
    end)
    
    print("Anti-Fling System: ACTIVE")
end

-- ==================== ANTI-RAGDOLL SYSTEM ====================
local function setupAntiRagdoll()
    if antiRagdollConnection then
        antiRagdollConnection:Disconnect()
    end
    
    antiRagdollConnection = RunService.Heartbeat:Connect(function()
        if not player.Character then return end
        
        local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
        if not humanoid then return end
        
        -- Prevent ragdoll state
        if humanoid:GetState() == Enum.HumanoidStateType.FallingDown or 
           humanoid:GetState() == Enum.HumanoidStateType.Ragdoll then
            humanoid:ChangeState(Enum.HumanoidStateType.Running)
        end
        
        -- Keep health above 0
        if humanoid.Health <= 0 then
            humanoid.Health = 1
        end
        
        -- Prevent physics-based ragdoll
        local torso = player.Character:FindFirstChild("Torso") or player.Character:FindFirstChild("UpperTorso")
        if torso then
            for _, weld in pairs(torso:GetChildren()) do
                if weld:IsA("Weld") or weld:IsA("Motor6D") then
                    -- Keep welds intact
                    if weld.Part1 and weld.Part1.Parent and weld.Part1.Parent.Name == "Ragdoll" then
                        weld:Destroy()
                    end
                end
            end
        end
    end)
end

-- ==================== CHARACTER SAFETY SYSTEM ====================
local function ensureCharacterSafety()
    if not player.Character then return end
    
    local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        -- Auto-respawn if dead
        if humanoid.Health <= 0 then
            humanoid.Health = 100
        end
        
        -- Prevent unwanted states
        humanoid.AutoRotate = true
        humanoid.AutoJumpEnabled = true
        
        -- Set walk speed to reasonable value
        if humanoid.WalkSpeed < 16 then
            humanoid.WalkSpeed = 16
        end
    end
    
    -- Remove any ragdoll parts
    for _, part in pairs(player.Character:GetChildren()) do
        if part.Name:find("Ragdoll") or part.Name:find("Limb") then
            if not part:IsA("BasePart") then continue end
            local isEssential = false
            for _, child in pairs(part:GetChildren()) do
                if child:IsA("Motor6D") or child:IsA("Weld") then
                    isEssential = true
                    break
                end
            end
            if not isEssential then
                part:Destroy()
            end
        end
    end
end

-- ==================== PROFESSIONAL GUI CREATOR ====================
local function CreateProfessionalGUI()
    -- Main ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "Flyzxastra"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- Main Container
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 400, 0, 650)
    MainFrame.Position = UDim2.new(0.5, -200, 0.5, -325)
    MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Parent = ScreenGui
    
    -- Modern Corner
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 16)
    UICorner.Parent = MainFrame
    
    -- Gradient Background
    local UIGradient = Instance.new("UIGradient")
    UIGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 25, 25)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(12, 12, 12))
    }
    UIGradient.Rotation = 90
    UIGradient.Parent = MainFrame
    
    -- Modern Stroke
    local UIStroke = Instance.new("UIStroke")
    UIStroke.Color = Color3.fromRGB(45, 45, 45)
    UIStroke.Transparency = 0.2
    UIStroke.Thickness = 2
    UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    UIStroke.Parent = MainFrame
    
    -- Title Bar
    local TitleBar = Instance.new("Frame")
    TitleBar.Size = UDim2.new(1, 0, 0, 50)
    TitleBar.BackgroundTransparency = 1
    TitleBar.Parent = MainFrame
    
    -- Title with Glow Effect
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0.7, 0, 1, 0)
    Title.Position = UDim2.new(0, 20, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "Flyzxastra"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 24
    Title.Font = Enum.Font.GothamBold
    Title.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Title Gradient
    local TitleGradient = Instance.new("UIGradient")
    TitleGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(100, 200, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 100, 255))
    }
    TitleGradient.Parent = Title
    
    Title.Parent = TitleBar
    
    -- Version Badge
    local VersionBadge = Instance.new("TextLabel")
    VersionBadge.Size = UDim2.new(0, 80, 0, 24)
    VersionBadge.Position = UDim2.new(0.7, 10, 0.5, -12)
    VersionBadge.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    VersionBadge.Text = "v2.4"
    VersionBadge.TextColor3 = Color3.fromRGB(180, 255, 180)
    VersionBadge.TextSize = 12
    VersionBadge.Font = Enum.Font.Gotham
    VersionBadge.Parent = TitleBar
    
    local VersionCorner = Instance.new("UICorner")
    VersionCorner.CornerRadius = UDim.new(0, 8)
    VersionCorner.Parent = VersionBadge
    
    -- Control Buttons
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 34, 0, 34)
    CloseButton.Position = UDim2.new(1, -42, 0, 8)
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    CloseButton.Text = "Ã—"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.TextSize = 28
    CloseButton.Parent = TitleBar
    
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 8)
    CloseCorner.Parent = CloseButton
    
    local MinimizeButton = Instance.new("TextButton")
    MinimizeButton.Size = UDim2.new(0, 34, 0, 34)
    MinimizeButton.Position = UDim2.new(1, -84, 0, 8)
    MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    MinimizeButton.Text = "âˆ’"
    MinimizeButton.TextColor3 = Color3.fromRGB(200, 200, 200)
    MinimizeButton.Font = Enum.Font.GothamBold
    MinimizeButton.TextSize = 28
    MinimizeButton.Parent = TitleBar
    
    local MinCorner = Instance.new("UICorner")
    MinCorner.CornerRadius = UDim.new(0, 8)
    MinCorner.Parent = MinimizeButton
    
    -- Content Area
    local Content = Instance.new("Frame")
    Content.Name = "Content"
    Content.Size = UDim2.new(1, 0, 1, -50)
    Content.Position = UDim2.new(0, 0, 0, 50)
    Content.BackgroundTransparency = 1
    Content.Parent = MainFrame
    
    -- Minimize functionality
    local minimized = false
    local originalSizeY = 650
    
    MinimizeButton.MouseButton1Click:Connect(function()
        minimized = not minimized
        if minimized then
            MainFrame.Size = UDim2.new(0, 400, 0, 50)
            MinimizeButton.Text = "+"
            MinimizeButton.TextColor3 = Color3.fromRGB(100, 255, 100)
            Content.Visible = false
        else
            MainFrame.Size = UDim2.new(0, 400, 0, originalSizeY)
            MinimizeButton.Text = "âˆ’"
            MinimizeButton.TextColor3 = Color3.fromRGB(200, 200, 200)
            Content.Visible = true
        end
    end)
    
    -- Close functionality
    CloseButton.MouseButton1Click:Connect(function()
        if auraConnection then 
            auraConnection:Disconnect() 
            auraConnection = nil
        end
        
        if antiRagdollConnection then
            antiRagdollConnection:Disconnect()
            antiRagdollConnection = nil
        end
        
        if antiFlingConnection then
            antiFlingConnection:Disconnect()
            antiFlingConnection = nil
        end
        
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player and p.Character then
                local hrp = p.Character:FindFirstChild("HumanoidRootPart")
                if hrp and originalSizes[hrp] then
                    hrp.Size = originalSizes[hrp]
                end
            end
        end
        
        ScreenGui:Destroy()
    end)
    
    -- Draggable functionality
    local dragging, dragInput, dragStart, startPos
    
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
        end
    end)
    
    TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X, 
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- Parent to player's GUI
    if player:FindFirstChild("PlayerGui") then
        ScreenGui.Parent = player.PlayerGui
    else
        player:WaitForChild("PlayerGui")
        ScreenGui.Parent = player.PlayerGui
    end
    
    return Content, ScreenGui
end

-- ==================== PROFESSIONAL CONTROL CREATORS ====================
local function CreateToggleButton(parent, text, yPosition)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0.9, 0, 0, 50)
    button.Position = UDim2.new(0.05, 0, yPosition, 0)
    button.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 80, 80)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 18
    button.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = button
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(60, 60, 60)
    stroke.Thickness = 2
    stroke.Parent = button
    
    return button
end

local function CreateSlider(parent, labelText, minValue, maxValue, defaultValue, yPosition, valueChangedCallback)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Name = "SliderFrame"
    sliderFrame.Size = UDim2.new(0.9, 0, 0, 60)
    sliderFrame.Position = UDim2.new(0.05, 0, yPosition, 0)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 20)
    label.BackgroundTransparency = 1
    label.Text = labelText
    label.TextColor3 = Color3.fromRGB(200, 200, 200)
    label.Font = Enum.Font.Gotham
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = sliderFrame
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Size = UDim2.new(0.2, 0, 0, 20)
    valueLabel.Position = UDim2.new(0.8, 0, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(defaultValue)
    valueLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
    valueLabel.Font = Enum.Font.GothamBold
    valueLabel.TextSize = 14
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Parent = sliderFrame
    
    local sliderContainer = Instance.new("Frame")
    sliderContainer.Size = UDim2.new(1, 0, 0, 30)
    sliderContainer.Position = UDim2.new(0, 0, 0, 25)
    sliderContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    sliderContainer.Parent = sliderFrame
    
    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(0, 8)
    sliderCorner.Parent = sliderContainer
    
    local sliderTrack = Instance.new("Frame")
    sliderTrack.Size = UDim2.new(0.9, 0, 0, 6)
    sliderTrack.Position = UDim2.new(0.05, 0, 0.5, -3)
    sliderTrack.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    sliderTrack.Parent = sliderContainer
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(1, 0)
    trackCorner.Parent = sliderTrack
    
    local sliderThumb = Instance.new("Frame")
    sliderThumb.Size = UDim2.new(0, 22, 0, 22)
    sliderThumb.Position = UDim2.new((defaultValue - minValue) / (maxValue - minValue), -11, 0.5, -11)
    sliderThumb.BackgroundColor3 = Color3.fromRGB(80, 180, 255)
    sliderThumb.Parent = sliderContainer
    
    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(1, 0)
    thumbCorner.Parent = sliderThumb
    
    local currentValue = defaultValue
    local draggingSlider = false
    
    local function updateSlider(value)
        currentValue = math.clamp(value, minValue, maxValue)
        local percentage = (currentValue - minValue) / (maxValue - minValue)
        sliderThumb.Position = UDim2.new(percentage, -11, 0.5, -11)
        valueLabel.Text = tostring(math.floor(currentValue))
        if valueChangedCallback then
            valueChangedCallback(currentValue)
        end
    end
    
    sliderThumb.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSlider = true
        end
    end)
    
    sliderContainer.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSlider = true
            local clickPos = input.Position.X - sliderContainer.AbsolutePosition.X
            local trackStart = sliderTrack.AbsolutePosition.X - sliderContainer.AbsolutePosition.X
            local trackEnd = trackStart + sliderTrack.AbsoluteSize.X
            if clickPos >= trackStart and clickPos <= trackEnd then
                local percentage = (clickPos - trackStart) / sliderTrack.AbsoluteSize.X
                local newValue = minValue + (percentage * (maxValue - minValue))
                updateSlider(newValue)
            end
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if draggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = input.Position
            local containerPos = sliderContainer.AbsolutePosition
            local trackStart = sliderTrack.AbsolutePosition.X - containerPos.X
            local trackWidth = sliderTrack.AbsoluteSize.X
            local relativeX = mousePos.X - containerPos.X
            local percentage = (relativeX - trackStart) / trackWidth
            percentage = math.clamp(percentage, 0, 1)
            local newValue = minValue + (percentage * (maxValue - minValue))
            updateSlider(newValue)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSlider = false
        end
    end)
    
    updateSlider(defaultValue)
    return sliderFrame
end

local function CreateTextBox(parent, placeholderText, yPosition, textChangedCallback)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(0.9, 0, 0, 40)
    container.Position = UDim2.new(0.05, 0, yPosition, 0)
    container.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    container.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = container
    
    local textBox = Instance.new("TextBox")
    textBox.Size = UDim2.new(1, -20, 1, -10)
    textBox.Position = UDim2.new(0, 10, 0, 5)
    textBox.BackgroundTransparency = 1
    textBox.Text = ""
    textBox.PlaceholderText = placeholderText
    textBox.TextColor3 = Color3.fromRGB(200, 200, 200)
    textBox.Font = Enum.Font.Gotham
    textBox.TextSize = 14
    textBox.TextXAlignment = Enum.TextXAlignment.Left
    textBox.ClearTextOnFocus = false
    textBox.Parent = container
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(60, 60, 60)
    stroke.Thickness = 1
    stroke.Parent = container
    
    textBox.FocusLost:Connect(function(enterPressed)
        if textChangedCallback then
            textChangedCallback(textBox.Text)
        end
    end)
    
    return textBox
end

-- ==================== MAIN GUI SETUP ====================
local content, screenGui = CreateProfessionalGUI()

local toggleButton = CreateToggleButton(content, "âš¡ SCRIPT: OFF", 0.02)
toggleButton.TextColor3 = Color3.fromRGB(255, 80, 80)

-- Target Players (comma separated)
local targetTextBox = CreateTextBox(content, "Target players (comma separated)", 0.12, function(text)
    targetPlayerNames = text
    updateTargetList()
end)

-- Avoid Players (comma separated)
local avoidTextBox = CreateTextBox(content, "Avoid players (comma separated)", 0.20, function(text)
    avoidPlayerNames = text
    updateAvoidList()
end)

-- APS SLIDER: 2X FASTER RANGE (1-3000) - DEFAULT 400
local apsSlider = CreateSlider(content, "Attacks Per Second:", 1, 3000, 400, 0.28, function(value)
    attacksPerSecond = value
    attackCooldown = 1 / attacksPerSecond
end)

local rangeSlider = CreateSlider(content, "Attack Range (studs):", 1, 250, 50, 0.40, function(value)
    attackRange = value
end)

local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0.9, 0, 0, 40)
statusLabel.Position = UDim2.new(0.05, 0, 0.64, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Status: Ready"
statusLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 14
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = content

local statsLabel = Instance.new("TextLabel")
statsLabel.Size = UDim2.new(0.9, 0, 0, 80)
statsLabel.Position = UDim2.new(0.05, 0, 0.72, 0)
statsLabel.BackgroundTransparency = 1
statsLabel.Text = "APS: 400\nRange: 50 studs\nAnti-Ragdoll: OFF\nAnti-Fling: OFF\nTarget: All players\nAvoid: None"
statsLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
statsLabel.Font = Enum.Font.Gotham
statsLabel.TextSize = 12
statsLabel.TextXAlignment = Enum.TextXAlignment.Left
statsLabel.TextYAlignment = Enum.TextYAlignment.Top
statsLabel.TextWrapped = true
statsLabel.Parent = content

local keybindLabel = Instance.new("TextLabel")
keybindLabel.Size = UDim2.new(0.9, 0, 0, 30)
keybindLabel.Position = UDim2.new(0.05, 0, 0.87, 0)
keybindLabel.BackgroundTransparency = 1
keybindLabel.Text = "Toggle Key: E"
keybindLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
keybindLabel.Font = Enum.Font.GothamBold
keybindLabel.TextSize = 14
keybindLabel.TextXAlignment = Enum.TextXAlignment.Left
keybindLabel.Parent = content

local warningLabel = Instance.new("TextLabel")
warningLabel.Size = UDim2.new(0.9, 0, 0, 50)
warningLabel.Position = UDim2.new(0.05, 0, 0.92, 0)
warningLabel.BackgroundTransparency = 1
warningLabel.Text = "âš¡ 2X FASTER HITS! (400 APS)\nâž• MULTI-TARGET/AVOID SUPPORT\nðŸ›¡ï¸ ANTI-RAGDOLL ACTIVE\nðŸš« ANTI-FLING SYSTEM"
warningLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
warningLabel.Font = Enum.Font.Gotham
warningLabel.TextSize = 11
warningLabel.TextXAlignment = Enum.TextXAlignment.Left
warningLabel.TextWrapped = true
warningLabel.Parent = content

local footerLabel = Instance.new("TextLabel")
footerLabel.Size = UDim2.new(0.9, 0, 0, 20)
footerLabel.Position = UDim2.new(0.05, 0, 0.97, 0)
footerLabel.BackgroundTransparency = 1
footerLabel.Text = "Flyzxastra v2.4 | Press E to toggle"
footerLabel.TextColor3 = Color3.fromRGB(100, 100, 100)
footerLabel.Font = Enum.Font.Gotham
footerLabel.TextSize = 10
footerLabel.TextXAlignment = Enum.TextXAlignment.Center
footerLabel.Parent = content

-- ==================== TARGETING LOGIC ====================
local function isPlayerTarget(playerObj)
    if playerObj == player then return false end
    
    local playerNameLower = playerObj.Name:lower()
    local displayNameLower = playerObj.DisplayName:lower()
    
    -- Skip if in avoid list
    if avoidList[playerNameLower] or avoidList[displayNameLower] then
        return false
    end
    
    -- If no specific targets, target all (except avoided players)
    if targetPlayerNames == "" then
        return true
    end
    
    -- Check exact matches
    if targetList[playerNameLower] or targetList[displayNameLower] then
        return true
    end
    
    -- Check partial matches
    for targetName in pairs(targetList) do
        if playerNameLower:find(targetName, 1, true) or displayNameLower:find(targetName, 1, true) then
            return true
        end
    end
    
    return false
end

-- ==================== KILL AURA LOGIC ====================
local function updateStats()
    local targetText = targetPlayerNames == "" and "All players" or targetPlayerNames
    local avoidText = avoidPlayerNames == "" and "None" or avoidPlayerNames
    
    statsLabel.Text = string.format("APS: %d\nRange: %d studs\nAnti-Ragdoll: %s\nAnti-Fling: %s\nTarget: %s\nAvoid: %s", 
        math.floor(attacksPerSecond), 
        math.floor(attackRange), 
        ScriptEnabled and "ON" or "OFF",
        ScriptEnabled and "ON" or "OFF",
        targetText,
        avoidText)
end

RunService.Heartbeat:Connect(function()
    updateStats()
end)

local function toggleScript()
    ScriptEnabled = not ScriptEnabled
    
    if ScriptEnabled then
        toggleButton.Text = "âš¡ SCRIPT: ON"
        toggleButton.TextColor3 = Color3.fromRGB(80, 255, 80)
        toggleButton.BackgroundColor3 = Color3.fromRGB(40, 70, 40)
        
        statusLabel.Text = "Status: Active (2X Faster + Anti-Fling)"
        statusLabel.TextColor3 = Color3.fromRGB(80, 255, 80)
        
        -- Start anti-ragdoll system
        setupAntiRagdoll()
        
        -- Start anti-fling system
        setupAntiFling()
        
        -- Ensure character safety
        ensureCharacterSafety()
        
        -- Increase hitbox size for all target players
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player and p.Character and isPlayerTarget(p) then
                local hrp = p.Character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    originalSizes[hrp] = hrp.Size
                    hrp.Size = Vector3.new(40, 40, 40)
                end
            end
        end
        
        auraConnection = RunService.Heartbeat:Connect(function(deltaTime)
            if not ScriptEnabled then return end
            if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
            
            local currentTime = tick()
            
            if currentTime - lastAttackTime < attackCooldown then
                return
            end
            
            local myHRP = player.Character.HumanoidRootPart
            local closest = nil
            local closestDist = attackRange
            
            -- Find closest valid target
            for _, p in pairs(Players:GetPlayers()) do
                if not isPlayerTarget(p) then continue end
                if not p.Character then continue end
                
                local hum = p.Character:FindFirstChild("Humanoid")
                local hrp = p.Character:FindFirstChild("HumanoidRootPart")
                
                if hum and hrp and hum.Health > 0 then
                    local dist = (hrp.Position - myHRP.Position).Magnitude
                    if dist <= attackRange and dist < closestDist then
                        closestDist = dist
                        closest = p
                    end
                end
            end
            
            -- Attack if we found a target
            if closest and closest.Character and closest.Character:FindFirstChild("Humanoid") then
                local args = {
                    closest.Character.Humanoid,
                    vector.create(myHRP.Position.X, myHRP.Position.Y, myHRP.Position.Z)
                }
                pcall(function()
                    HitRemote:InvokeServer(unpack(args))
                    lastAttackTime = currentTime
                end)
            end
            
            -- Maintain character safety during aura
            ensureCharacterSafety()
        end)
        
        print("Flyzxastra: Script ENABLED")
        print(string.format("Settings: %d APS (400 Default!), %d range", attacksPerSecond, attackRange))
        print("Anti-Ragdoll: ACTIVE")
        print("Anti-Fling: ACTIVE")
        print("Target List:", targetPlayerNames == "" and "All" or targetPlayerNames)
        print("Avoid List:", avoidPlayerNames == "" and "None" or avoidPlayerNames)
        
    else
        toggleButton.Text = "âš¡ SCRIPT: OFF"
        toggleButton.TextColor3 = Color3.fromRGB(255, 80, 80)
        toggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        
        statusLabel.Text = "Status: Disabled"
        statusLabel.TextColor3 = Color3.fromRGB(255, 150, 150)
        
        if auraConnection then
            auraConnection:Disconnect()
            auraConnection = nil
        end
        
        if antiRagdollConnection then
            antiRagdollConnection:Disconnect()
            antiRagdollConnection = nil
        end
        
        if antiFlingConnection then
            antiFlingConnection:Disconnect()
            antiFlingConnection = nil
        end
        
        -- Restore original sizes
        for hrp, oldSize in pairs(originalSizes) do
            if hrp and hrp.Parent then
                hrp.Size = oldSize
            end
        end
        originalSizes = {}
        lastAttackTime = 0
        
        print("Flyzxastra: Script DISABLED")
    end
end

toggleButton.MouseButton1Click:Connect(toggleScript)

local keybindConnection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.E then
        toggleScript()
    end
end)

screenGui.Destroying:Connect(function()
    if keybindConnection then
        keybindConnection:Disconnect()
    end
    if auraConnection then
        auraConnection:Disconnect()
    end
    if antiRagdollConnection then
        antiRagdollConnection:Disconnect()
    end
    if antiFlingConnection then
        antiFlingConnection:Disconnect()
    end
end)

updateStats()
updateTargetList()
updateAvoidList()

print("==============================================")
print("Flyzxastra v2.4")
print("Loaded Successfully!")
print("âš¡ HITS ARE NOW 2X FASTER! (400 APS Default)")
print("ðŸ›¡ï¸ ANTI-RAGDOLL SYSTEM ACTIVE")
print("ðŸš« ANTI-FLING SYSTEM ACTIVE")
print("ðŸŽ¯ MULTI-TARGET SUPPORT (comma-separated)")
print("==============================================")

-- Parent GUI
ScreenGui.Parent = player:WaitForChild("PlayerGui")

print("Flyzxastra GUI Loaded Successfully!")